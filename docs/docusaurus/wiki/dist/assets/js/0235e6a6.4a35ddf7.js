"use strict";(self.webpackChunkwiki=self.webpackChunkwiki||[]).push([[625],{2159:(e,s,l)=>{l.r(s),l.d(s,{assets:()=>u,contentTitle:()=>t,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Tips/logs","title":"\ud83d\udd0d Cheatsheet jq \u2013 Logs Caddy & Authelia","description":"Ce document liste les commandes jq les plus utiles pour analyser rapidement les logs JSON de Caddy et Authelia depuis le terminal.","source":"@site/docs/Tips/logs.md","sourceDirName":"Tips","slug":"/Tips/logs","permalink":"/Tips/logs","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Website","permalink":"/Services/website"},"next":{"title":"Troubleshooting","permalink":"/Tips/troubleshooting"}}');var a=l(4848),n=l(8453);const i={},t="\ud83d\udd0d Cheatsheet jq \u2013 Logs Caddy & Authelia",u={},c=[{value:"\ud83d\udce6 Pr\xe9-requis",id:"-pr\xe9-requis",level:2},{value:"\ud83e\udded Caddy \u2013 <code>/var/log/caddy/access.json</code>",id:"-caddy--varlogcaddyaccessjson",level:2},{value:"\ud83d\udd39 Afficher toutes les requ\xeates HTTP",id:"-afficher-toutes-les-requ\xeates-http",level:3},{value:"\ud83d\udd39 Filtrer les erreurs HTTP (4xx / 5xx)",id:"-filtrer-les-erreurs-http-4xx--5xx",level:3},{value:"\ud83d\udd39 Voir uniquement les 401 / 403 (auth / acc\xe8s refus\xe9)",id:"-voir-uniquement-les-401--403-auth--acc\xe8s-refus\xe9",level:3},{value:"\ud83d\udd39 IPs qui g\xe9n\xe8rent le plus d\u2019erreurs",id:"-ips-qui-g\xe9n\xe8rent-le-plus-derreurs",level:3},{value:"\ud83d\udd39 Voir les requ\xeates lentes (&gt; 1 seconde)",id:"-voir-les-requ\xeates-lentes--1-seconde",level:3},{value:"\ud83d\udd39 Voir les routes les plus appel\xe9es",id:"-voir-les-routes-les-plus-appel\xe9es",level:3},{value:"\ud83d\udd39 Suivre les logs en temps r\xe9el",id:"-suivre-les-logs-en-temps-r\xe9el",level:3},{value:"\ud83d\udd39 Voir les requ\xeates vers Authelia uniquement",id:"-voir-les-requ\xeates-vers-authelia-uniquement",level:3},{value:"\ud83d\udd10 Authelia \u2013 <code>/var/log/authelia/authelia.json</code>",id:"-authelia--varlogautheliaautheliajson",level:2},{value:"\ud83d\udd39 Afficher tous les logs",id:"-afficher-tous-les-logs",level:3},{value:"\ud83d\udd39 Voir uniquement les erreurs",id:"-voir-uniquement-les-erreurs",level:3},{value:"\ud83d\udd39 Voir les tentatives d\u2019authentification \xe9chou\xe9es",id:"-voir-les-tentatives-dauthentification-\xe9chou\xe9es",level:3},{value:"\ud83d\udd39 Voir les \xe9checs MFA / second facteur",id:"-voir-les-\xe9checs-mfa--second-facteur",level:3},{value:"\ud83d\udd39 Voir les erreurs OIDC",id:"-voir-les-erreurs-oidc",level:3},{value:"\ud83d\udd39 Voir les erreurs par utilisateur",id:"-voir-les-erreurs-par-utilisateur",level:3},{value:"\ud83d\udd39 Suivre les logs Authelia en temps r\xe9el",id:"-suivre-les-logs-authelia-en-temps-r\xe9el",level:3},{value:"\ud83e\udde0 Combinaisons utiles",id:"-combinaisons-utiles",level:2},{value:"\ud83d\udd39 Logs r\xe9cents (derni\xe8res 100 lignes)",id:"-logs-r\xe9cents-derni\xe8res-100-lignes",level:3},{value:"\ud83d\udd39 IP + route + status (Caddy)",id:"-ip--route--status-caddy",level:3},{value:"\ud83d\udd39 Tentatives d\u2019auth par IP (Authelia)",id:"-tentatives-dauth-par-ip-authelia",level:3},{value:"\ud83d\udca1 Astuce bonus",id:"-astuce-bonus",level:2}];function o(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsxs)(s.h1,{id:"-cheatsheet-jq--logs-caddy--authelia",children:["\ud83d\udd0d Cheatsheet ",(0,a.jsx)(s.code,{children:"jq"})," \u2013 Logs Caddy & Authelia"]})}),"\n",(0,a.jsxs)(s.p,{children:["Ce document liste les commandes ",(0,a.jsx)(s.code,{children:"jq"})," les plus utiles pour analyser rapidement les logs ",(0,a.jsx)(s.strong,{children:"JSON"})," de ",(0,a.jsx)(s.strong,{children:"Caddy"})," et ",(0,a.jsx)(s.strong,{children:"Authelia"})," depuis le terminal."]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"-pr\xe9-requis",children:"\ud83d\udce6 Pr\xe9-requis"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"sudo apt install jq\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"-caddy--varlogcaddyaccessjson",children:["\ud83e\udded Caddy \u2013 ",(0,a.jsx)(s.code,{children:"/var/log/caddy/access.json"})]}),"\n",(0,a.jsx)(s.h3,{id:"-afficher-toutes-les-requ\xeates-http",children:"\ud83d\udd39 Afficher toutes les requ\xeates HTTP"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq '.' /var/log/caddy/access.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-filtrer-les-erreurs-http-4xx--5xx",children:"\ud83d\udd39 Filtrer les erreurs HTTP (4xx / 5xx)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.status >= 400)' /var/log/caddy/access.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-uniquement-les-401--403-auth--acc\xe8s-refus\xe9",children:"\ud83d\udd39 Voir uniquement les 401 / 403 (auth / acc\xe8s refus\xe9)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.status == 401 or .status == 403)' /var/log/caddy/access.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-ips-qui-g\xe9n\xe8rent-le-plus-derreurs",children:"\ud83d\udd39 IPs qui g\xe9n\xe8rent le plus d\u2019erreurs"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq -r 'select(.status >= 400) | .request.remote_ip' /var/log/caddy/access.json \\\n| sort | uniq -c | sort -nr | head\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-requ\xeates-lentes--1-seconde",children:"\ud83d\udd39 Voir les requ\xeates lentes (> 1 seconde)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.duration > 1)' /var/log/caddy/access.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-routes-les-plus-appel\xe9es",children:"\ud83d\udd39 Voir les routes les plus appel\xe9es"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq -r '.request.uri' /var/log/caddy/access.json \\\n| sort | uniq -c | sort -nr | head\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-suivre-les-logs-en-temps-r\xe9el",children:"\ud83d\udd39 Suivre les logs en temps r\xe9el"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"tail -f /var/log/caddy/access.json | jq '.status'\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-requ\xeates-vers-authelia-uniquement",children:"\ud83d\udd39 Voir les requ\xeates vers Authelia uniquement"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.request.uri | contains(\"/api/authz\"))' /var/log/caddy/access.json\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"-authelia--varlogautheliaautheliajson",children:["\ud83d\udd10 Authelia \u2013 ",(0,a.jsx)(s.code,{children:"/var/log/authelia/authelia.json"})]}),"\n",(0,a.jsx)(s.h3,{id:"-afficher-tous-les-logs",children:"\ud83d\udd39 Afficher tous les logs"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq '.' /var/log/authelia/authelia.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-uniquement-les-erreurs",children:"\ud83d\udd39 Voir uniquement les erreurs"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.level == \"error\")' /var/log/authelia/authelia.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-tentatives-dauthentification-\xe9chou\xe9es",children:"\ud83d\udd39 Voir les tentatives d\u2019authentification \xe9chou\xe9es"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.msg | contains(\"Authentication failed\"))' /var/log/authelia/authelia.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-\xe9checs-mfa--second-facteur",children:"\ud83d\udd39 Voir les \xe9checs MFA / second facteur"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.msg | contains(\"Second factor\"))' /var/log/authelia/authelia.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-erreurs-oidc",children:"\ud83d\udd39 Voir les erreurs OIDC"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq 'select(.msg | contains(\"OIDC\"))' /var/log/authelia/authelia.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-voir-les-erreurs-par-utilisateur",children:"\ud83d\udd39 Voir les erreurs par utilisateur"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq -r 'select(.level==\"error\") | .message' /var/log/authelia/authelia.json \\\n| sort | uniq -c | sort -nr\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-suivre-les-logs-authelia-en-temps-r\xe9el",children:"\ud83d\udd39 Suivre les logs Authelia en temps r\xe9el"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"tail -f /var/log/authelia/authelia.json | jq '.message'\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"-combinaisons-utiles",children:"\ud83e\udde0 Combinaisons utiles"}),"\n",(0,a.jsx)(s.h3,{id:"-logs-r\xe9cents-derni\xe8res-100-lignes",children:"\ud83d\udd39 Logs r\xe9cents (derni\xe8res 100 lignes)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"tail -n 100 /var/log/caddy/access.json | jq '.'\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-ip--route--status-caddy",children:"\ud83d\udd39 IP + route + status (Caddy)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq -r '[.request.remote_ip, .request.uri, .status] | @tsv' /var/log/caddy/access.json\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-tentatives-dauth-par-ip-authelia",children:"\ud83d\udd39 Tentatives d\u2019auth par IP (Authelia)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq -r 'select(.msg | contains(\"Authentication\")) | .remote_ip' /var/log/authelia/authelia.json \\\n| sort | uniq -c | sort -nr\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"-astuce-bonus",children:"\ud83d\udca1 Astuce bonus"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"jq '.' | less\n"})})]})}function d(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,s,l)=>{l.d(s,{R:()=>i,x:()=>t});var r=l(6540);const a={},n=r.createContext(a);function i(e){const s=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(n.Provider,{value:s},e.children)}}}]);